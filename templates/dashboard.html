{% extends "base.html" %}

{% block title %}SmartHire AI - HR Dashboard{% endblock %}

{% block content %}
<!-- View All Modal -->
<div class="modal fade" id="viewAllModal" tabindex="-1" aria-labelledby="viewAllModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="viewAllModalLabel">View All Items</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-dark table-hover" id="viewAllTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Score</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="viewAllTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Export to Excel</button>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center py-3 border-bottom">
        <div>
            <h1 class="h3 mb-1 text-white">HR Dashboard</h1>
            <p class="text-muted mb-0">Welcome back! Here's your recruitment overview.</p>
        </div>
        <div class="d-flex">
            <div class="dropdown me-3">
                <button class="btn btn-dark dropdown-toggle border border-secondary" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-calendar-alt me-2"></i>Last 30 Days
                </button>
                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="filterDropdown">
                    <li><a class="dropdown-item" href="#">Last 7 Days</a></li>
                    <li><a class="dropdown-item active" href="#">Last 30 Days</a></li>
                    <li><a class="dropdown-item" href="#">Last 90 Days</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#">Custom Range</a></li>
                </ul>
            </div>
            <div class="btn-group" role="group">
                <a href="{{ url_for('resume_screening_route') }}" class="btn btn-outline-light me-2">
                    <i class="fas fa-users me-1"></i> Candidates
                </a>
                <a href="{{ url_for('hr_interviews') }}" class="btn btn-outline-light me-2">
                    <i class="fas fa-calendar-day me-1"></i> Interviews
                </a>
                <a href="{{ url_for('manage_appointments') }}" class="btn btn-outline-light">
                    <i class="fas fa-calendar-check me-1"></i> Schedule
                </a>
            </div>
            <button class="btn btn-primary ms-3" data-bs-toggle="modal" data-bs-target="#newJobPostingModal">
                <i class="fas fa-plus me-1"></i>New Job
            </button>
        </div>
    </div>
</div>

    <!-- Stats Cards -->
    <div class="row g-4 my-3">
        <!-- Analytics Stats Row -->
        <div class="col-12 mb-4">
            <div class="card border-0 shadow-sm bg-dark">
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(45deg, #4e54c8, #8f94fb);">
                                <i class="bi bi-people"></i>
                                <h3 id="totalCandidates">0</h3>
                                <p>Total Candidates</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(45deg, #11998e, #38ef7d);">
                                <i class="bi bi-graph-up"></i>
                                <h3 id="avgScore">0%</h3>
                                <p>Avg. ATS Score</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(45deg, #f46b45, #eea849);">
                                <i class="bi bi-calendar-check"></i>
                                <h3 id="interviewsScheduled">0</h3>
                                <p>Interviews Scheduled</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(45deg, #8e2de2, #4a00e0);">
                                <i class="bi bi-trophy"></i>
                                <h3 id="hiringRate">0%</h3>
                                <p>Hiring Rate</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Total Applications -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm bg-dark">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="bg-primary bg-opacity-25 p-3 rounded-3">
                            <i class="fas fa-file-alt text-primary"></i>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-success bg-opacity-25 text-success">
                                <i class="fas fa-arrow-up me-1"></i>12%
                            </span>
                        </div>
                    </div>
                    <h3 class="mb-1 text-white">{{ total_applications|default('0') }}</h3>
                    <p class="text-muted mb-0">Total Applications</p>
                    <div class="progress mt-3 bg-dark" style="height: 4px;">
                        <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shortlisted -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="bg-success bg-opacity-10 p-3 rounded-3">
                            <i class="fas fa-clipboard-check text-success"></i>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-success bg-opacity-10 text-success">
                                <i class="fas fa-arrow-up me-1"></i>8%
                            </span>
                        </div>
                    </div>
                    <h3 class="mb-1">{{ (total_applications * 0.45)|round|int }}</h3>
                    <p class="text-muted mb-0">Shortlisted</p>
                    <div class="progress mt-3" style="height: 4px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 45%" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interviews -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="bg-info bg-opacity-10 p-3 rounded-3">
                            <i class="fas fa-calendar-alt text-info"></i>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-danger bg-opacity-10 text-danger">
                                <i class="fas fa-arrow-down me-1"></i>3%
                            </span>
                        </div>
                    </div>
                    <h3 class="mb-1">{{ interviews_scheduled|default('0') }}</h3>
                    <p class="text-muted mb-0">Interviews</p>
                    <div class="progress mt-3" style="height: 4px;">
                        <div class="progress-bar bg-info" role="progressbar" style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hired -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="bg-warning bg-opacity-10 p-3 rounded-3">
                            <i class="fas fa-user-check text-warning"></i>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-success bg-opacity-10 text-success">
                                <i class="fas fa-arrow-up me-1"></i>5%
                            </span>
                        </div>
                    </div>
                    <h3 class="mb-1">{{ (total_applications * 0.15)|round|int }}</h3>
                    <p class="text-muted mb-0">Hired</p>
                    <div class="progress mt-3" style="height: 4px;">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 15%" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-left-info shadow h-100 py-2 bg-dark">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Interview Scheduled</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">18</div>
                            <div class="mt-2">
                                <span class="text-warning">3 today</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar-alt fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Average Time to Hire</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">24 days</div>
                            <div class="mt-2 text-danger">
                                <i class="fas fa-arrow-down"></i> 2 days longer
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row g-4 mt-2">
        <!-- Left Column -->
        <div class="col-lg-8">
            <!-- Hiring Trends Chart -->
            <div class="card border-0 shadow-sm h-100 bg-dark">
                <div class="card-header border-bottom border-secondary py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-white">Hiring Trends</h5>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="chartFilter" data-bs-toggle="dropdown" aria-expanded="false">
                                This Month
                            </button>
                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="chartFilter">
                                <li><a class="dropdown-item" href="#">This Week</a></li>
                                <li><a class="dropdown-item active" href="#">This Month</a></li>
                                <li><a class="dropdown-item" href="#">This Year</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    {{ hiring_trends|safe }}
                </div>
            </div>
        </div>
        
        <!-- Right Column -->
        <div class="col-lg-4">
            <!-- ATS Score Distribution -->
            <div class="card border-0 shadow-sm h-100 bg-dark">
                <div class="card-header border-bottom border-secondary py-3">
                    <h5 class="mb-0 text-white">ATS Score Distribution</h5>
                </div>
                <div class="card-body">
                    <div id="resume-chart">
                        {{ resume_chart|safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row g-4 mt-2">
        <!-- Left Column - Recruitment Pipeline -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 bg-dark">
                <div class="card-header border-bottom border-secondary py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-white">Recruitment Pipeline</h5>
                    <button type="button" class="btn btn-sm btn-outline-light view-all-btn" data-type="pipeline">View All</button>
                </div>
                <div class="card-body">
                    <div id="pipeline-chart">
                        {{ pipeline_chart|safe }}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Column - Top Candidates -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 bg-dark">
                <div class="card-header border-bottom border-secondary py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-white">Top Candidates</h5>
                    <button type="button" class="btn btn-sm btn-outline-light view-all-btn" data-type="top-candidates">View All</button>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for candidate in candidates %}
                        <div class="list-group-item list-group-item-action border-0 py-3 bg-dark" style="border-bottom: 1px solid #2d2d2d !important;">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <div class="avatar avatar-md">
                                        <span class="avatar-text bg-primary text-white">{{ candidate.name.split(' ')|map('first')|join('')|upper }}</span>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0 text-white">{{ candidate.name }}</h6>
                                        <span class="badge bg-success bg-opacity-25 text-success">{{ candidate.score }}%</span>
                                    </div>
                                    <p class="text-muted mb-0 small">{{ candidate.status }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row g-4 mt-2">
        <!-- Left Column - Recent Activities -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 bg-dark">
                <div class="card-header border-bottom border-secondary py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-white">Recent Activities</h5>
                    <button type="button" class="btn btn-sm btn-outline-light view-all-btn" data-type="activities">View All</button>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for activity in activities %}
                        <div class="list-group-item border-0 py-3 bg-dark text-white" style="border-bottom: 1px solid #2d2d2d !important;">
                            <div class="d-flex">
                                <div class="flex-shrink-0">
                                    <div class="avatar avatar-sm">
                                        <span class="avatar-text bg-{{ 'success' if 'Hired' in activity.action else 'info' if 'Interview' in activity.action else 'primary' }}">
                                            {{ activity.candidate.split(' ')|map('first')|join('')|upper }}
                                        </span>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="d-flex justify-content-between">
                                        <h6 class="mb-1 text-white">{{ activity.candidate }}</h6>
                                        <small class="text-muted">{{ activity.time }}</small>
                                    </div>
                                    <p class="mb-0">
                                        <span class="badge bg-{{ 'success' if 'Hired' in activity.action else 'info' if 'Interview' in activity.action else 'primary' }} bg-opacity-25 text-{{ 'success' if 'Hired' in activity.action else 'info' if 'Interview' in activity.action else 'primary' }} me-2">
                                            {{ activity.action }}
                                        </span>
                                        <span class="text-muted">for Senior Developer position</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Column - Skill Distribution -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 bg-dark">
                <div class="card-header border-bottom border-secondary py-3">
                    <h5 class="mb-0 text-white">Skill Distribution</h5>
                </div>
                <div class="card-body">
                    <div id="skill-chart">
                        {{ skill_chart|safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>    
        <!-- Sentiment Analysis -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100 bg-dark">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-dark border-bottom border-secondary">
                    <h6 class="m-0 font-weight-bold text-white">Exit Interview Sentiment Analysis</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            {{ sentiment_chart|safe }}
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-center mb-3">Sentiment Breakdown</h6>
                            <style>
                                .progress-positive {
                                    --progress-width: {{ (sentiment_data['Positive'] / sentiment_total) * 100 }}%;
                                }
                                .progress-neutral {
                                    --progress-width: {{ (sentiment_data['Neutral'] / sentiment_total) * 100 }}%;
                                }
                                .progress-negative {
                                    --progress-width: {{ (sentiment_data['Negative'] / sentiment_total) * 100 }}%;
                                }
                                .progress-bar {
                                    width: var(--progress-width);
                                }
                            </style>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Positive</span>
                                    <span class="text-success font-weight-bold">{{ sentiment_data['Positive'] }}</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-success progress-positive" role="progressbar"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Neutral</span>
                                    <span class="text-warning font-weight-bold">{{ sentiment_data['Neutral'] }}</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-warning progress-neutral" role="progressbar"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Negative</span>
                                    <span class="text-danger font-weight-bold">{{ sentiment_data['Negative'] }}</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-danger progress-negative" role="progressbar"></div>
                                </div>
                            </div>
                            <p class="small text-muted mt-3">
                                <i class="fas fa-info-circle"></i> Based on analysis of exit interview feedback using natural language processing.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Top Candidates -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100 bg-dark">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-white">Top Candidates</h6>
                    <button type="button" class="btn btn-sm btn-primary view-all-btn" data-type="top-candidates">View All</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Score</th>
                                    <th>Status</th>
                                    <th>Applied</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for candidate in candidates %}
                                <tr>
                                    <td>{{ candidate.name }}</td>
                                    <td>
                                        <span class="badge badge-pill badge-{{ 'success' if candidate.score >= 90 else 'warning' if candidate.score >= 80 else 'info' }}">
                                            {{ candidate.score }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if candidate.status == 'Offer Sent' %}bg-success
                                            {% elif candidate.status == 'Interview Scheduled' %}bg-primary
                                            {% elif candidate.status == 'Interviewed' %}bg-info
                                            {% else %}bg-secondary{% endif %}">
                                            {{ candidate.status }}
                                        </span>
                                    </td>
                                    <td>{{ candidate.applied }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary view-candidate" data-bs-toggle="modal" data-bs-target="#candidateModal" 
                                                data-name="{{ candidate.name }}" 
                                                data-score="{{ candidate.score }}"
                                                data-status="{{ candidate.status }}"
                                                data-applied="{{ candidate.applied }}">
                                            View
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Mock data for the View All modal
    const mockData = {
        'pipeline': [
            { id: 1, name: 'John Doe', status: 'Applied', date: '2023-10-26', score: 92 },
            { id: 2, name: 'Jane Smith', status: 'Screened', date: '2023-10-25', score: 88 },
            { id: 3, name: 'Robert Johnson', status: 'Interview', date: '2023-10-24', score: 85 },
            { id: 4, name: 'Emily Davis', status: 'Offered', date: '2023-10-23', score: 90 },
            { id: 5, name: 'Michael Brown', status: 'Hired', date: '2023-10-22', score: 95 },
        ],
        'candidates': [
            { id: 1, name: 'John Doe', status: 'Interview Scheduled', date: '2023-10-26', score: 92 },
            { id: 2, name: 'Jane Smith', status: 'Offer Sent', date: '2023-10-25', score: 88 },
            { id: 3, name: 'Robert Johnson', status: 'New Application', date: '2023-10-24', score: 85 },
            { id: 4, name: 'Emily Davis', status: 'Interviewed', date: '2023-10-23', score: 82 },
            { id: 5, name: 'Michael Brown', status: 'Screening', date: '2023-10-22', score: 79 },
        ],
        'activities': [
            { id: 1, name: 'John Doe', status: 'Applied', date: '2023-10-26 10:30', score: 92 },
            { id: 2, name: 'Jane Smith', status: 'Interview Scheduled', date: '2023-10-25 14:15', score: 88 },
            { id: 3, name: 'Robert Johnson', status: 'Resume Reviewed', date: '2023-10-24 09:45', score: 85 },
            { id: 4, name: 'Emily Davis', status: 'Offer Accepted', date: '2023-10-23 16:20', score: 90 },
            { id: 5, name: 'Michael Brown', status: 'Rejected', date: '2023-10-22 11:10', score: 70 },
        ],
        'top-candidates': [
            { id: 1, name: 'John Doe', status: 'Interview Scheduled', date: '2023-10-26', score: 98 },
            { id: 2, name: 'Jane Smith', status: 'Offer Sent', date: '2023-10-25', score: 95 },
            { id: 3, name: 'Robert Johnson', status: 'New Application', date: '2023-10-24', score: 93 },
            { id: 4, name: 'Emily Davis', status: 'Interviewed', date: '2023-10-23', score: 91 },
            { id: 5, name: 'Michael Brown', status: 'Screening', date: '2023-10-22', score: 89 },
        ]
    };

    // Function to populate the modal with data
    function populateModal(data) {
        const tableBody = document.getElementById('viewAllTableBody');
        tableBody.innerHTML = ''; // Clear existing rows
        
        data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.id}</td>
                <td>${item.name}</td>
                <td><span class="badge bg-${getStatusBadgeClass(item.status)}">${item.status}</span></td>
                <td>${item.date}</td>
                <td><span class="badge bg-${getScoreBadgeClass(item.score)}">${item.score}%</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-info me-1 view-details" data-id="${item.id}">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Helper function to get badge class based on status
    function getStatusBadgeClass(status) {
        const statusMap = {
            'Applied': 'primary',
            'Screened': 'info',
            'Interview': 'warning',
            'Interview Scheduled': 'warning',
            'Interviewed': 'info',
            'Offered': 'success',
            'Hired': 'success',
            'Rejected': 'danger',
            'New Application': 'primary',
            'Screening': 'secondary'
        };
        return statusMap[status] || 'secondary';
    }

    // Helper function to get badge class based on score
    function getScoreBadgeClass(score) {
        if (score >= 90) return 'success';
        if (score >= 80) return 'info';
        if (score >= 70) return 'primary';
        if (score >= 60) return 'warning';
        return 'danger';
    }

    // Initialize analytics data and charts
    function initAnalytics() {
        // Sample data - replace with actual API calls
        const analyticsData = {
            totalCandidates: 128,
            avgScore: 78.5,
            interviewsScheduled: 24,
            hiringRate: 15.2,
            scoreDistribution: {
                labels: ['0-20', '21-40', '41-60', '61-80', '81-100'],
                data: [5, 15, 30, 45, 30]
            },
            hiringTrends: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                hired: [3, 5, 4, 7, 6, 8],
                rejected: [12, 15, 18, 14, 16, 13]
            },
            topSkills: ['Python', 'JavaScript', 'SQL', 'AWS', 'React']
        };

        // Update stats
        document.getElementById('totalCandidates').textContent = analyticsData.totalCandidates;
        document.getElementById('avgScore').textContent = analyticsData.avgScore + '%';
        document.getElementById('interviewsScheduled').textContent = analyticsData.interviewsScheduled;
        document.getElementById('hiringRate').textContent = analyticsData.hiringRate + '%';

        // Initialize charts
        initScoreDistributionChart(analyticsData.scoreDistribution);
        initHiringTrendsChart(analyticsData.hiringTrends);
    }

    function initScoreDistributionChart(data) {
        const ctx = document.getElementById('scoreDistributionChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Number of Candidates',
                    data: data.data,
                    backgroundColor: 'rgba(78, 115, 223, 0.8)',
                    borderColor: 'rgba(78, 115, 223, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { text: 'Score Distribution', display: true }
                },
                scales: { y: { beginAtZero: true } }
            }
        });
    }

    function initHiringTrendsChart(data) {
        const ctx = document.getElementById('hiringTrendsChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [
                    {
                        label: 'Hired',
                        data: data.hired,
                        borderColor: 'rgba(40, 167, 69, 1)',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Rejected',
                        data: data.rejected,
                        borderColor: 'rgba(220, 53, 69, 1)',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { text: 'Hiring Trends', display: true }
                },
                interaction: { mode: 'index', intersect: false },
                scales: { y: { beginAtZero: true } }
            }
        });
    }

    // Initialize event listeners for View All buttons
    document.addEventListener('DOMContentLoaded', function() {
        initAnalytics();
        // View All buttons
        document.querySelectorAll('.view-all-btn').forEach(button => {
            button.addEventListener('click', function() {
                const dataType = this.getAttribute('data-type');
                const modalTitle = document.getElementById('viewAllModalLabel');
                
                // Set modal title based on button type
                const titles = {
                    'pipeline': 'Recruitment Pipeline - All Candidates',
                    'candidates': 'All Candidates',
                    'activities': 'Recent Activities',
                    'top-candidates': 'Top Candidates'
                };
                
                modalTitle.textContent = titles[dataType] || 'View All Items';
                
                // Populate modal with data
                if (mockData[dataType]) {
                    populateModal(mockData[dataType]);
                }
                
                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('viewAllModal'));
                modal.show();
            });
        });

        // View details button in modal (event delegation)
        document.addEventListener('click', function(e) {
            if (e.target.closest('.view-details')) {
                const itemId = e.target.closest('.view-details').getAttribute('data-id');
                alert(`Viewing details for item ID: ${itemId}`);
                // You can implement a more detailed view or navigation here
            }
        });
    });
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded');
        
        // Debug: Log if Plotly is available
        console.log('Plotly available:', typeof Plotly !== 'undefined');
        
        // Debug: Check if chart containers exist
        const hiringTrendsEl = document.getElementById('hiring-trends-chart');
        const resumeChartEl = document.getElementById('resume-chart');
        const pipelineChartEl = document.getElementById('pipeline-chart');
        const skillChartEl = document.getElementById('skill-chart');
        
        console.log('Hiring trends element:', hiringTrendsEl ? 'Found' : 'Not found');
        console.log('Resume chart element:', resumeChartEl ? 'Found' : 'Not found');
        console.log('Pipeline chart element:', pipelineChartEl ? 'Found' : 'Not found');
        console.log('Skill chart element:', skillChartEl ? 'Found' : 'Not found');
        
        // Function to check if a Plotly chart exists in a container
        function hasChartData(containerId) {
            const container = document.getElementById(containerId);
            return container && container.innerHTML.trim() !== '';
        }
        
        // Initialize charts with a small delay to ensure DOM is ready
        setTimeout(function() {
            // Force Plotly to redraw all charts
            if (typeof Plotly !== 'undefined') {
                const charts = document.querySelectorAll('.js-plotly-plot');
                console.log('Found charts to redraw:', charts.length);
                
                charts.forEach(function(chart, i) {
                    try {
                        Plotly.Plots.resize(chart);
                        console.log('Redrawn chart', i, 'at', chart.id || 'unknown');
                    } catch (error) {
                        console.error('Error redrawing chart', i, ':', error);
                    }
                });
                
                // Check if we need to manually trigger a resize for any missing charts
                const chartIds = ['hiring-trends-chart', 'resume-chart', 'pipeline-chart', 'skill-chart'];
                chartIds.forEach(function(id) {
                    if (!hasChartData(id)) {
                        console.warn('Chart data missing for:', id);
                    }
                });
            } else {
                console.error('Plotly is not loaded');
            }
            
            // Trigger resize event to ensure proper rendering
            window.dispatchEvent(new Event('resize'));
        }, 500);
    });
</script>
{% endblock %}

{% block extra_css %}
<style>
:root {
    --primary: #4e73df;
    --secondary: #858796;
    --success: #1cc88a;
    --info: #36b9cc;
    --warning: #f6c23e;
    --danger: #e74a3b;
    --light: #f8f9fc;
    --dark: #5a5c69;
}

body {
    background-color: #1a1a1a;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: #f8f9fa;
}

.card {
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.card:hover {
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.05);
    transform: translateY(-2px);
}

.card-header {
    background-color: #fff;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    font-weight: 600;
}

.avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 0.375rem;
}

.avatar-sm {
    width: 32px;
    height: 32px;
}

.avatar-md {
    width: 48px;
    height: 48px;
}

.avatar-text {
    font-weight: 600;
    font-size: 0.875rem;
}

.badge {
    font-weight: 500;
    padding: 0.35em 0.65em;
    border-radius: 0.25rem;
}

.progress {
    border-radius: 0.25rem;
    height: 4px;
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Custom dropdown */
.dropdown-menu {
    border: none;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    padding: 0.5rem;
}

.dropdown-item {
    border-radius: 0.375rem;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.dropdown-item.active, .dropdown-item:active {
    background-color: var(--primary);
}

/* Custom buttons */
.btn-outline-primary {
    color: var(--primary);
    border-color: var(--primary);
}

.btn-outline-primary:hover {
    background-color: var(--primary);
    border-color: var(--primary);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .card {
        margin-bottom: 1rem;
    }
}
    .card {
        border: none;
        border-radius: 10px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1) !important;
    }
    
    .progress {
        border-radius: 10px;
        height: 10px;
    }
    
    .progress-bar {
        border-radius: 10px;
    }
    
    .badge {
        font-weight: 500;
        padding: 0.4em 0.8em;
    }
</style>
{% endblock %}